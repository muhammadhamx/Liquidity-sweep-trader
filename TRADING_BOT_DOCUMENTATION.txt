================================================================================
ü§ñ AUTOMATED LIQUIDITY SWEEP TRADING BOT - COMPLETE DOCUMENTATION
================================================================================

üìã TABLE OF CONTENTS:
1. Bot Overview & Strategy
2. State Machine Explanation
3. Trading Conditions & Requirements
4. State Transitions & Triggers
5. Risk Management & Limits
6. Troubleshooting Common Issues

================================================================================
1. üéØ BOT OVERVIEW & STRATEGY
================================================================================

STRATEGY: Asian Liquidity Sweep Reversal Trading
- Detects when price sweeps above/below Asian session range
- Waits for reversal confirmation on multiple timeframes
- Executes counter-trend trades with strict risk management

CORE CONCEPT:
- Asian session (00:00-06:00 UTC) establishes daily range
- Institutional traders sweep liquidity above/below this range
- Smart money then reverses direction, creating trading opportunity
- Bot captures this reversal with precise entry timing

TIMEFRAMES USED:
- Asian Range: M5 data from 00:00-06:00 UTC
- Sweep Detection: Real-time price monitoring
- Reversal Confirmation: M5 displacement + M1 CHOCH
- Confluence: H4 and D1 bias analysis

================================================================================
2. üîÑ STATE MACHINE EXPLANATION
================================================================================

The bot operates through 6 distinct states:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IDLE ‚Üí SWEPT ‚Üí CONFIRMED ‚Üí ARMED ‚Üí IN_TRADE ‚Üí COOLDOWN                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

IDLE STATE:
- What it means: Bot is monitoring for liquidity sweeps
- What happens: Continuously checks if price breaks Asian range by 10+ pips
- Duration: Until sweep detected or day ends
- Conditions checked: Current price vs Asian high/low + 10 pip threshold

SWEPT STATE:
- What it means: Liquidity sweep detected, waiting for reversal confirmation
- What happens: Monitors M5 and M1 timeframes for reversal signals
- Duration: Until reversal confirmed or timeout (30 minutes)
- Conditions checked: M5 displacement (body > 50% ATR) + M1 CHOCH

CONFIRMED STATE:
- What it means: Reversal confirmed, waiting for retest and confluence
- What happens: Monitors for price retest of Asian midpoint ¬± 5 pips
- Duration: 15 minutes (3 M5 bars) retest window
- Conditions checked: Retest touch + confluence (spread, bias, news)

ARMED STATE:
- What it means: Trade signal generated, ready to execute
- What happens: Waits for optimal entry trigger
- Duration: Until entry executed or signal expires
- Conditions checked: Entry price reached + final validations

IN_TRADE STATE:
- What it means: Active trade running
- What happens: Monitors for TP/SL hits, manages position
- Duration: Until trade closed (TP/SL/timeout/news)
- Conditions checked: Price vs TP/SL levels, time limits, news events

COOLDOWN STATE:
- What it means: Trading session ended, no more trades today
- What happens: Bot stops trading until next day
- Duration: Until next trading day
- Triggers: Both sides swept, daily limits reached, major errors

================================================================================
3. ‚úÖ TRADING CONDITIONS & REQUIREMENTS
================================================================================

ASIAN RANGE REQUIREMENTS:
‚úì Range size: 50-200 pips (NORMAL grade)
‚úì Clean range: No major gaps or anomalies
‚úì Sufficient data: Complete M5 data from 00:00-06:00 UTC

SWEEP DETECTION REQUIREMENTS:
‚úì Price break: Must exceed Asian high/low by 10+ pips
‚úì Direction: UP sweep (above high) or DOWN sweep (below low)
‚úì Timing: Outside Asian session hours (after 06:00 UTC)
‚úì Single side: Only one direction per day (prevents whipsaws)

REVERSAL CONFIRMATION REQUIREMENTS:
‚úì M5 Displacement: Candle body > 50% of ATR (shows momentum)
‚úì M1 CHOCH: Change of Character on 1-minute chart
‚úì Direction: Must be opposite to sweep direction
‚úì Timing: Within 30 minutes of sweep detection

CONFLUENCE REQUIREMENTS:
‚úì Spread Gate: XAUUSD spread ‚â§ 2.0 pips
‚úì HTF Bias: H4 and D1 trend alignment (optional but preferred)
‚úì News Blackout: No HIGH/CRITICAL news within 30 minutes
‚úì Retest: Price touches Asian midpoint ¬± 5 pips within 15 minutes

EXECUTION REQUIREMENTS:
‚úì Account balance: Sufficient for position sizing
‚úì Daily limits: <3 trades, <2 losses per day
‚úì Market hours: Forex market open (not weekends)
‚úì Connection: Stable MT5 connection

================================================================================
4. üîÑ STATE TRANSITIONS & TRIGGERS
================================================================================

IDLE ‚Üí SWEPT:
Trigger: Price breaks Asian range by 10+ pips
Example: Asian high 3380, current price 3390.5 = UP sweep detected
Action: Create LiquiditySweep record, update session state

SWEPT ‚Üí CONFIRMED:
Trigger: M5 displacement + M1 CHOCH detected
Example: M5 bearish candle with body > 50% ATR + M1 shows CHOCH
Action: Set confirmation_time, start 15-minute retest window

CONFIRMED ‚Üí ARMED:
Trigger: Retest touched + confluence passed
Example: Price hits 3386.82 ¬± 5 pips + spread OK + no news
Action: Generate TradeSignal with entry/SL/TP levels

ARMED ‚Üí IN_TRADE:
Trigger: Entry price reached + order executed
Example: SELL order at 3387.00 gets filled
Action: Create TradeExecution record, start trade management

IN_TRADE ‚Üí COOLDOWN:
Trigger: Trade closed (TP/SL hit, timeout, or manual close)
Example: Stop loss hit at 3392.00
Action: Update daily counters, log trade result

ANY STATE ‚Üí COOLDOWN:
Trigger: Daily limits reached, both sides swept, or major error
Example: 3 trades executed today OR UP and DOWN sweeps both occurred
Action: Stop trading until next day

================================================================================
5. üõ°Ô∏è RISK MANAGEMENT & LIMITS
================================================================================

POSITION SIZING:
- Risk per trade: 0.5% of account balance
- Minimum lot size: 0.01
- Maximum lot size: Calculated based on SL distance
- Example: $10,000 account, 50 pip SL = 0.10 lots

STOP LOSS RULES:
- UP sweep: SL above Asian high + buffer
- DOWN sweep: SL below Asian low + buffer
- Buffer: 10-15 pips beyond range extreme
- No SL modification once set

TAKE PROFIT TARGETS:
- TP1: 1.5R (1.5x risk amount) - 50% position closed
- TP2: 2.5R (2.5x risk amount) - remaining 50% closed
- Minimum R:R ratio: 1:1.5

DAILY LIMITS:
- Maximum trades: 3 per day
- Maximum losses: 2 per day
- Reset time: 00:00 UTC daily
- Hard stop: No override possible

TIME LIMITS:
- Sweep to confirmation: 30 minutes maximum
- Confirmation to retest: 15 minutes maximum
- Maximum time in trade: 4 hours
- Session end: Close all trades at 06:00 UTC

NEWS BLACKOUT:
- HIGH/CRITICAL impact news: 30-minute buffer
- Automatic trade closure during news
- No new trades during blackout periods

================================================================================
6. üîß TROUBLESHOOTING COMMON ISSUES
================================================================================

ISSUE: "No M5 data returned for XAUUSD"
CAUSE: Market closed (weekends), MT5 connection issues, or no data in time range
SOLUTION:
- Normal on weekends (market closed)
- Check MT5 connection if on weekdays
- Bot automatically retries with different time ranges
- Restart MT5 connection if persistent issues

ISSUE: Bot stuck in IDLE state
CAUSE: No significant price movement or range not broken
SOLUTION: Normal behavior - wait for market to provide setup

ISSUE: Bot stuck in SWEPT state
CAUSE: No reversal confirmation within 30 minutes
SOLUTION: Normal behavior - not all sweeps lead to trades

ISSUE: Bot stuck in CONFIRMED state
CAUSE: No retest within 15 minutes or confluence failed
SOLUTION: Normal behavior - strict conditions prevent bad trades

ISSUE: "Daily limits reached"
CAUSE: 3 trades or 2 losses already executed today
SOLUTION: Wait until next trading day (00:00 UTC)

ISSUE: "Both sides swept - entering cooldown"
CAUSE: Price swept both Asian high and low in same day
SOLUTION: Wait until next trading day - prevents whipsaw trades

ISSUE: Trades not executing
CAUSE: Confluence requirements not met (spread, bias, news)
SOLUTION: Normal behavior - bot waits for optimal conditions

ISSUE: Connection errors
CAUSE: MT5 terminal not running or login issues
SOLUTION: Check MT5 terminal, verify credentials, restart connection

================================================================================
üìä PERFORMANCE EXPECTATIONS
================================================================================

TRADE FREQUENCY: 1-3 trades per day (not every day has setups)
WIN RATE: 60-70% (quality over quantity approach)
RISK/REWARD: Minimum 1:1.5, target 1:2.5
MAXIMUM DRAWDOWN: 2% per day (2 losses √ó 0.5% each + spread costs)

BEST MARKET CONDITIONS:
- Trending markets with clear Asian ranges
- Normal volatility (50-200 pip Asian ranges)
- Clean price action without major news disruptions

CHALLENGING CONDITIONS:
- Sideways/choppy markets
- Very low volatility (<50 pip ranges)
- High-impact news during trading hours
- Weekend gaps affecting Asian range calculation

================================================================================
üéØ KEY SUCCESS FACTORS
================================================================================

1. PATIENCE: Not every day has tradeable setups
2. DISCIPLINE: Strict adherence to state machine rules
3. RISK MANAGEMENT: Never risk more than 0.5% per trade
4. MARKET RESPECT: Accept when conditions aren't optimal
5. SYSTEM TRUST: Let the algorithm make decisions

Remember: This bot is designed for QUALITY trades, not quantity.
Some days will have no trades - this is normal and expected behavior.

================================================================================
üîß RECENT IMPROVEMENTS (August 2025)
================================================================================

M5 DATA RETRIEVAL FIXES:
‚úÖ Improved error handling for M5 data requests
‚úÖ Added fallback strategies with multiple time ranges (20, 30, 40 minutes)
‚úÖ Better weekend/market closed detection and messaging
‚úÖ Automatic retry logic for connection issues
‚úÖ More informative error messages distinguishing between weekends and issues

TIMEZONE FIXES:
‚úÖ Fixed all timezone warnings by using timezone.now() instead of datetime.now()
‚úÖ Proper timezone-aware datetime handling throughout the system
‚úÖ Eliminated database warnings about naive datetime objects

CONNECTION IMPROVEMENTS:
‚úÖ Simplified connection logic to use environment variables only
‚úÖ Removed manual credential input requirements
‚úÖ Added real-time connection status monitoring
‚úÖ Created modern dashboard with automatic status updates

SYSTEM RELIABILITY:
‚úÖ Enhanced error recovery and graceful degradation
‚úÖ Better logging and diagnostic information
‚úÖ Improved state machine robustness
‚úÖ More reliable data retrieval with multiple fallback strategies

================================================================================
